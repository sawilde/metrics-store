<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>
      Simple Chart Sample Using Data From Metrics-Store
    </title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.google.com/jsapi"></script>
	<script type="text/javascript">
      google.load('visualization', '1', {packages: ['corechart']});
    </script>
	<script>

    function drawVisualization(values){
	  
	  var data = new google.visualization.DataTable();
      data.addColumn('date', 'Date');
      data.addColumn('number', 'Coverage');
	  
	  for (var i=0; i < values.length; i++) {
	    data.addRow([new Date(values[i].date), values[i].value]);
	  }
	  visualization = new google.visualization.LineChart(document.getElementById('visualization'));
      visualization.draw(data, {curveType: "function",
                        width: 500, height: 400,
                        vAxis: {maxValue: 100, minValue: 0}});
	}	
	
	function getDataAndVisualize(){
        $.getJSON('/metrics/opencover_release?callback=?', function(data) {
		  drawVisualization(data.values);
		})
		.error(function(err) { drawVisualization([]); }); // probably 404
	}
	
	$( document ).ready( function() {
	  getDataAndVisualize();
    });

	</script>
	<body>
  	  <div id="visualization"></div>
	</body>	
</html>